const WeftsCalculator = () => {
  const [level, setLevel] = useState("L3");
  const [rows, setRows] = useState(2);
  const [wpr, setWpr] = useState(3);
  const [length, setLength] = useState("18");

  // Totals
  const totalWefts = rows * wpr;

  // Time model per your Reference Guide: 3→1h, 6→2h, 9→3h, 12→4h
  // Round UP to the next multiple of 3 (capped at 12).
  const blocks = clamp(Math.ceil(totalWefts / 3), 1, 4);
  const hours = blocks * 1;

  // Labels for legend
  const labels = [
    "mini volume",
    "volume & length",
    "full volume & length",
    "mega volume & length",
  ];
  const currentLabel = labels[blocks - 1];

  const hairCost = totalWefts * WEFT_PRICE[length];
  const labor = hours * HOURLY[level];
  const total = hairCost + labor;

  return (
    <div className="card p-5 space-y-4">
      <div className="flex justify-between items-center">
        <h3 className="font-semibold flowe-serif text-lg">Wefts Calculator</h3>
        <span className="pill">Reference: 3 wefts ≈ 1h</span>
      </div>

      <div className="grid md:grid-cols-4 gap-4 items-end">
        <label className="block text-sm">
          <span className="flowe-muted">Stylist Level</span>
          <select
            className="w-full border flowe-border p-2 rounded-xl mt-1"
            value={level}
            onChange={(e) => setLevel(e.target.value)}
          >
            <option value="L1">Level 1 ($85/hr)</option>
            <option value="L2">Level 2 ($100/hr)</option>
            <option value="L3">Level 3 ($150/hr)</option>
          </select>
        </label>

        <label className="block text-sm">
          <span className="flowe-muted">Rows</span>
          <select
            className="w-full border flowe-border p-2 rounded-xl mt-1"
            value={rows}
            onChange={(e) => setRows(parseInt(e.target.value))}
          >
            <option value="1">1 Row</option>
            <option value="2">2 Rows</option>
          </select>
        </label>

        <label className="block text-sm">
          <span className="flowe-muted">Wefts / Row</span>
          <input
            type="range"
            min="3"
            max="6"
            step="1"
            value={wpr}
            onChange={(e) => setWpr(parseInt(e.target.value))}
            className="w-full mt-2"
          />
          <div className="text-xs flowe-muted mt-1">
            Current: <span className="font-medium text-black">{wpr}</span>
          </div>
        </label>

        <label className="block text-sm">
          <span className="flowe-muted">Length</span>
          <select
            className="w-full border flowe-border p-2 rounded-xl mt-1"
            value={length}
            onChange={(e) => setLength(e.target.value)}
          >
            <option value="18">18" ($110/weft)</option>
            <option value="24">24" ($170/weft)</option>
          </select>
        </label>
      </div>

      <div className="grid md:grid-cols-3 gap-4">
        <div className="border flowe-border p-3 rounded-xl">
          <Stat label="Total Wefts" value={totalWefts} />
          <Stat label="Hair Cost" value={<Currency amount={hairCost} />} />
          <div className="text-xs flowe-muted mt-1">
            {length}" @ ${WEFT_PRICE[length]}/weft
          </div>
        </div>
        <div className="border flowe-border p-3 rounded-xl">
          <Stat label="Labor" value={<Currency amount={labor} />} />
          <div className="text-xs flowe-muted mt-1">
            {level} @ ${HOURLY[level]}/hr × {hours}h
          </div>
        </div>
        <div className="border bg-black text-white p-3 rounded-xl">
          <Stat label="Total" value={<Currency amount={total} />} />
        </div>
      </div>

      {/* Live legend */}
      <div className="border flowe-border p-3 rounded-xl bg-[var(--flowe-card)]">
        <div className="flex flex-wrap items-center gap-2 text-sm">
          <span className="pill">{totalWefts} weft{totalWefts !== 1 ? "s" : ""}</span>
          <span className="pill">{currentLabel}</span>
          <span className="pill">~{hours}h</span>
        </div>
        <div className="text-xs flowe-muted mt-2">
          Guide: 3 wefts → 1h · 6 wefts → 2h · 9 wefts → 3h · 12 wefts → 4h (rounded up)
        </div>
      </div>
    </div>
  );
};
